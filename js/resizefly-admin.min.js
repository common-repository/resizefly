(function ($) {
var buttonIds=["#"+window.resizefly.purge_id,"#"+window.resizefly.resized_id],$buttons=$(buttonIds.join(","));$("#"+window.resizefly.purge_id+"-smart").on("change",function(){$("#"+window.resizefly.purge_id+"-text").text($(this).prop("checked")?window.resizefly.purge_most:window.resizefly.purge_all)}),$buttons.on("click",function(e){e.preventDefault();var t=$(this),i={action:t.attr("id"),_ajax_nonce:t.data("nonce"),"smart-purge":$("#"+t.attr("id")+"-smart").is(":checked")},r="#"+t.attr("id")+"-result";t.next(".spinner").addClass("is-active"),$buttons.prop("disabled",!0),$.post(window.ajaxurl,i).done(function(e){e.files?$(r).html(window.resizefly.purge_result).children(".resizefly-files").text(e.files).parent().children(".resizefly-size").text(byteCalc.humanReadable(e.size)):$(r).text(window.resizefly.purge_empty)}).fail(function(e){alert(e.responseText)}).always(function(){t.next(".spinner").removeClass("is-active"),$buttons.prop("disabled",!1)})});var byteCalc={round:function(e,t){var i=Math.pow(10,t),r=e*i;return Math.round(r)/i},humanReadable:function(e){if(0===e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return this.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]}},$registeredSection=$('label[for="resizefly_sizes_section"]').parents("tr"),$userSection=$('label[for="resizefly_user_sizes"]').parents("tr"),$toggle=$("#resizefly_restrict_sizes");function showHideTable(e,t){e?t.show():t.hide()}showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection),$toggle.on("change",function(){showHideTable($toggle.is(":checked"),$registeredSection),showHideTable($toggle.is(":checked"),$userSection)});var unsaved=!1,$error=$("#js-rzf-user-sizes-error"),$add=$("#js-rzf-user-size-add");$(document).keypress(function(e){13===e.which&&$("#rzf-user-sizes").find("input:focus").length&&(e.preventDefault(),$add.trigger("click"))}),$add.on("click",function(e){e.preventDefault();var r,n={},t=$(this);t.attr("disabled","disabled"),$error.empty(),t.parent(".rzf-user-sizes-single").siblings(".rzf-user-sizes-single").each(function(){var e=$(this).find('input[name!=""]'),t=e.attr("name").match(/resizefly_user_sizes\[clone]\[([a-z]+?)]/i);if(n[t[1]]=$.trim(e.val()),e[0].reportValidity(),!e[0].checkValidity())return r=t[1],!1;if("name"===t[1]){var i=$(".rzf-size-name").map(function(){return $.trim($(this).text())}).toArray();if(-1<$.inArray($.trim(e.val()),i))return $error.append($("<div>").text(window.resizefly.user_size_errors.name)),r=t[1],!1}}),r?t.removeAttr("disabled"):($error.empty(),0===$('input[name="resizefly_user_sizes[clone][name]"]').length&&$error.append($("<div>").text(window.resizefly.user_size_errors.name)),$.post(window.ajaxurl,{action:t.data("action"),ajax_nonce:t.data("nonce"),size:n}).always(function(e){t.removeAttr("disabled")}).done(function(r){unsaved=!0,r.data.crop="boolean"==typeof r.data.crop?!!r.data.crop:r.data.crop.join(",");var e=wp.template("rzf-size-row"),n=0;$(".rzf-size").each(function(e,t){var i=$(t).data();if(n=e,!(i.width<r.data.width)){if(i.height>r.data.height)return!1;if(!(i.width===r.data.width&&i.height===r.data.height&&i.name<r.data.name))return!1}}),0===n?$(".rzf-image-sizes tbody").prepend(e(r.data)):$(""+e(r.data)).insertAfter(".rzf-size:nth-child("+n+")"),$(".rzf-user-sizes-single").find("input").each(function(){$(this).val("").prop("checked",!1)})}).fail(function(e){$.each(e.responseJSON.data,function(e,t){$error.append($("<div>").text(window.resizefly.user_size_errors[t]))})}))}),$(document).on("click",".js-rzf-user-size-readd",function(e){e.preventDefault();var t=$(this),i=$(this).parents("tr").eq(0);t.attr("disabled","disabled"),$error.empty(),$.post(window.ajaxurl,{action:t.data("action"),ajax_nonce:t.data("nonce"),size:i.data()}).always(function(e){t.removeAttr("disabled")}).done(function(e){unsaved=!0;var t=wp.template("rzf-size-row");$(t(e.data)).insertBefore(i),i.remove(),$(".rzf-size.rzf-size-status-missing").length||$(".rzf-size-status-desc .rzf-size-status-missing").addClass("hidden")}).fail(function(e){$.each(e.responseJSON.data,function(e,t){$error.append($("<div>").text(window.resizefly.user_size_errors[t]))})})}),$(document).on("click",".js-rzf-user-size-delete",function(e){e.preventDefault();var t=$(this);t.attr("disabled","disabled"),$.post(window.ajaxurl,{action:t.data("action"),ajax_nonce:t.data("nonce"),size:t.data("size-name")}).always(function(e){t.removeAttr("disabled")}).done(function(){t.closest("tr").addClass("rzf-size-status-missing").find("input").each(function(){$(this).remove()}),t.remove(),unsaved=!0}).fail(function(){})}),$("#js-rzf-toggle-crop").on("change",function(){var e=$('[name="resizefly_user_sizes[clone][crop]"]'),t=$("#js-rzf-crop-x"),i=$("#js-rzf-crop-y"),r=t.add(i);this.checked?(r.removeAttr("disabled"),e.val(t.val()+", "+i.val()),r.on("change",function(){e.val(t.val()+", "+i.val())})):(r.attr("disabled","disabled"),e.val(this.checked))}),$("#rzf-size-missing-save").on("click",function(e){e.preventDefault()}),$('form[action="options.php"]').on("submit",function(){unsaved=!1}),window.addEventListener("beforeunload",function(e){unsaved&&(e.returnValue=!0)});
})(jQuery);